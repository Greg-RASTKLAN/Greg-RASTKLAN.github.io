<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Like Button JSONP</title>
<style>
  #heart { opacity: 0; position: absolute; left: -9999px; }
  .like-button { display: flex; align-items: center; justify-content: space-between; height: 48px; width: 150px; background: #3a3a3a; border-radius: 16px; padding: 0 10px; cursor: pointer; }
  .like { display: flex; align-items: center; cursor: pointer; }
  .like-icon { fill: #505050; height: 28px; width: 28px; margin-right: 8px; transition: fill 0.2s, transform 0.2s; }
  .like-text { color: #fcfcfc; font-family: "Segoe UI", sans-serif; font-size: 16px; }
  .like-count { color: #717070; font-family: "Segoe UI", sans-serif; font-size: 16px; transition: color 0.3s; }
  .on:checked + label .like-icon { fill: #fc4e4e; transform: scale(1.2); }
  .on:checked ~ .like-count { color: #fcfcfc; }
</style>
</head>
<body>

<div class="like-button">
  <input type="checkbox" id="heart" class="on">
  <label class="like" for="heart">
    <svg class="like-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z"/>
    </svg>
    <span class="like-text">Likes</span>
  </label>
  <span class="like-count">0</span>
</div>

<script>
  const heart = document.getElementById("heart");
  const likeCount = document.querySelector(".like-count");
  const API_URL = "https://script.google.com/macros/s/AKfycbyUlUiMW9XjDoZwWXp52DUcM5FAyvcXaLXs-q9sLMBPBhSKBo-lKxztziqfFiW_YNmm/exec"; // Remplacer par l'URL de la Web App

  function logStep(step, info) { console.log("[DEBUG]", step, info); }

  function updateLike(data) {
    logStep("updateLike", data);
    if (data.count !== undefined) {
      likeCount.textContent = data.count;
    } else if (data.error) {
      console.error("[ERROR serveur]", data.error);
    }
  }

  // Charger compteur initial
  (function loadInitial() {
    logStep("loadInitial", "Création du script JSONP initial");
    const script = document.createElement("script");
    script.src = API_URL + "?callback=updateLike";
    script.onload = () => logStep("loadInitial", "Script initial chargé avec succès");
    script.onerror = () => console.error("[ERROR] Erreur chargement compteur initial :", script.src);
    document.body.appendChild(script);
  })();

  // Clic pour liker
  heart.addEventListener("change", () => {
    logStep("clic", "Checkbox.checked = " + heart.checked);
    if (heart.checked) {
      logStep("clic", "Création script JSONP pour like=1");
      const script = document.createElement("script");
      script.src = API_URL + "?like=1&callback=updateLike";
      script.onload = () => logStep("clic", "Script like chargé avec succès");
      script.onerror = () => console.error("[ERROR] Erreur chargement script like :", script.src);
      document.body.appendChild(script);
    }
  });
</script>

</body>
</html>
